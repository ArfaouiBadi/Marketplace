{% extends 'base.html.twig' %}

{% block title %}{{ product.name }} - MarketPlace{% endblock %}

{% block body %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    {# Breadcrumb #}
    <nav class="text-sm text-gray-500 mb-6">
        <a href="{{ path('app_home') }}" class="hover:text-primary-600">Accueil</a>
        <span class="mx-2">/</span>
        <a href="{{ path('product_list') }}" class="hover:text-primary-600">Produits</a>
        {% if product.category %}
            <span class="mx-2">/</span>
            <a href="{{ path('category_show', {slug: product.category.slug}) }}" class="hover:text-primary-600">{{ product.category.name }}</a>
        {% endif %}
        <span class="mx-2">/</span>
        <span class="text-gray-900">{{ product.name }}</span>
    </nav>

    <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-0">
            {# Product image #}
            <div class="bg-gray-100 h-96 flex items-center justify-center">
                {% if product.image %}
                    <img src="{{ asset('uploads/products/' ~ product.image) }}" alt="{{ product.name }}" class="w-full h-full object-cover">
                {% else %}
                    <span class="text-8xl">ðŸ“¦</span>
                {% endif %}
            </div>

            {# Product info #}
            <div class="p-8">
                {% if product.category %}
                    <span class="inline-block bg-primary-50 text-primary-700 text-xs px-3 py-1 rounded-full mb-3">{{ product.category.name }}</span>
                {% endif %}

                <h1 class="text-3xl font-bold text-gray-900 mb-2">{{ product.name }}</h1>

                <p class="text-sm text-gray-500 mb-4">
                    Par <span class="font-semibold text-gray-700">{{ product.supplier.companyName }}</span>
                </p>

                <div class="text-3xl font-bold text-primary-600 mb-6">{{ product.price }} â‚¬</div>

                {% if product.stock > 0 %}
                    <div class="flex items-center gap-2 mb-6">
                        <span class="w-3 h-3 bg-green-500 rounded-full"></span>
                        <span class="text-sm text-green-700 font-medium">En stock ({{ product.stock }} disponible{{ product.stock > 1 ? 's' : '' }})</span>
                    </div>
                {% else %}
                    <div class="flex items-center gap-2 mb-6">
                        <span class="w-3 h-3 bg-red-500 rounded-full"></span>
                        <span class="text-sm text-red-700 font-medium">Rupture de stock</span>
                    </div>
                {% endif %}

                {% if product.description %}
                    <div class="border-t border-gray-200 pt-4 mb-6">
                        <h3 class="text-sm font-semibold text-gray-900 mb-2">Description</h3>
                        <p class="text-gray-600 text-sm leading-relaxed">{{ product.description }}</p>
                    </div>
                {% endif %}

                {% if product.stock > 0 and is_granted('ROLE_CLIENT') %}
                    <form action="{{ path('cart_add', {id: product.id}) }}" method="POST" class="flex items-center gap-4">
                        <input type="hidden" name="_token" value="{{ csrf_token('cart_add') }}">
                        <div class="flex items-center border border-gray-300 rounded-lg">
                            <input type="number" name="quantity" value="1" min="1" max="{{ product.stock }}" class="w-16 text-center py-2 border-0 focus:ring-0 text-sm">
                        </div>
                        <button type="submit" class="flex-1 bg-primary-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-primary-700 transition">
                            Ajouter au panier
                        </button>
                    </form>
                {% elseif not is_granted('ROLE_CLIENT') %}
                    <a href="{{ path('app_login') }}" class="block text-center bg-primary-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-primary-700 transition">
                        Connectez-vous pour acheter
                    </a>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}